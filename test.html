<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Restaurant Finder</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
  </head>
  <body>
    <div id="map"></div>
    <div id="restaurants"></div>

    <script>
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: -33.8666, lng: 151.1958 },
          zoom: 15,
        });

        // Obter localização atual do usuário
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function (position) {
              var pos = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              map.setCenter(pos);

              // Pesquisar por restaurantes próximos
              var request = {
                location: pos,
                radius: '500',
                type: ['restaurant'],
              };

              var service = new google.maps.places.PlacesService(map);
              service.nearbySearch(request, callback);
            },
            function () {
              handleLocationError(true, infoWindow, map.getCenter());
            }
          );
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function callback(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          var restaurantsContainer = document.getElementById('restaurants');
          restaurantsContainer.innerHTML = '';

          for (var i = 0; i < results.length; i++) {
            var place = results[i];
            var restaurantInfo = document.createElement('div');
            restaurantInfo.innerHTML = '<h3>' + place.name + '</h3>';

            // Obter informações detalhadas sobre o restaurante (incluindo cardápio)
            var request = {
              placeId: place.place_id,
              fields: [
                'name',
                'formatted_address',
                'rating',
                'opening_hours',
                'website',
                'photos',
                'menu',
              ],
            };

            var service = new google.maps.places.PlacesService(
              document.createElement('div')
            );
            service.getDetails(request, function (placeDetails, status) {
              if (status === google.maps.places.PlacesServiceStatus.OK) {
                var menu = placeDetails.menu
                  ? '<p>Menu: <a href="' +
                    placeDetails.menu.url +
                    '">View Menu</a></p>'
                  : '';
                var restaurantDetails =
                  '<p>Address: ' +
                  placeDetails.formatted_address +
                  '</p>' +
                  '<p>Rating: ' +
                  placeDetails.rating +
                  '</p>' +
                  (placeDetails.opening_hours
                    ? '<p>Hours: ' +
                      placeDetails.opening_hours.weekday_text.join('<br>') +
                      '</p>'
                    : '') +
                  (placeDetails.website
                    ? '<p>Website: <a href="' +
                      placeDetails.website +
                      '">' +
                      placeDetails.website +
                      '</a></p>'
                    : '') +
                  menu;
                restaurantInfo.innerHTML += restaurantDetails;
              } else {
                console.error('Error fetching place details:', status);
              }
            });

            restaurantsContainer.appendChild(restaurantInfo);
          }
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        console.error('Error: Geolocation failed.');
      }
    </script>
    <script
      async
      defer
      src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMap"
    ></script>
  </body>
</html>
